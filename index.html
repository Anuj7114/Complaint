
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Customer Name Autocomplete Demo</title>
  <style>
    .autocomplete-items {
      position: absolute;
      background: #fff;
      border: 1px solid #aaa;
      max-height: 180px;
      overflow-y: auto;
      border-radius: 5px;
      width: 100%;
      z-index: 1000;
    }
    .autocomplete-item {
      padding: 10px 15px;
      cursor: pointer;
    }
    .autocomplete-item:hover,
    .autocomplete-active { background: #e0e7ef; }
    .row { display: flex; gap: 8px; }
    .row > div { flex: 1; }
  </style>
</head>
<body>
  <form autocomplete="off" style="max-width:400px;margin:30px auto;position:relative">
    <label>Customer Name</label>
    <input id="customerSearchInput" name="name" type="text" placeholder="Type customer name..." autocomplete="name" required>
    <div id="customerAutocompleteList" class="autocomplete-items" style="display:none;"></div>
    <label>STB Number</label>
    <input id="stbNumber" name="stbNumber" type="text" autocomplete="off" readonly>
    <label>Address</label>
    <input id="customerAddress" name="address" autocomplete="street-address" readonly>
    <div class="row">
      <div>
        <label>GPS</label>
        <input id="customerLocation" name="gps" autocomplete="off" readonly>
      </div>
      <div>
        <label>Phone 1</label>
        <input id="phone1" name="phone1" autocomplete="tel" readonly>
      </div>
    </div>
    <div class="row">
      <div>
        <label>Phone 2</label>
        <input id="phone2" name="phone2" autocomplete="tel" readonly>
      </div>
      <div>
        <label>Phone 3</label>
        <input id="phone3" name="phone3" autocomplete="tel" readonly>
      </div>
    </div>
  </form>
  <script>
    // CHANGE THIS TO YOUR SHEETDB CUSTOMERS ENDPOINT
    const SHEETDB_CUSTOMERS_API = "https://sheetdb.io/api/v1/f5vg3sptzr3d4";
    // Map your sheet headers exactly
    const customerFields = {
      stb: "STB Number",
      name: "NAME",
      address: "ADD",
      gps: "GPS",
      phone1: "PHONE 1",
      phone2: "PHONE 2",
      phone3: "PHONE 3"
    };
    let customerList = [];

    async function fetchCustomerList() {
      try {
        const res = await fetch(SHEETDB_CUSTOMERS_API);
        customerList = await res.json();
        setupCustomerAutocomplete();
      } catch (e) {
        customerList = [];
        setupCustomerAutocomplete();
      }
    }

    function fillCustomerDetails(customer) {
      document.getElementById('stbNumber').value = customer[customerFields.stb] || "";
      document.getElementById('customerAddress').value = customer[customerFields.address] || "";
      document.getElementById('customerLocation').value = customer[customerFields.gps] || "";
      document.getElementById('phone1').value = customer[customerFields.phone1] || "";
      document.getElementById('phone2').value = customer[customerFields.phone2] || "";
      document.getElementById('phone3').value = customer[customerFields.phone3] || "";
    }

    function setupCustomerAutocomplete() {
      const input = document.getElementById('customerSearchInput');
      const list = document.getElementById('customerAutocompleteList');
      let activeIndex = -1;
      input.oninput = function() {
        const val = this.value.trim().toLowerCase();
        list.innerHTML = '';
        activeIndex = -1;
        if (!val || customerList.length === 0) {
          list.style.display = 'none';
          return;
        }
        const nameKey = customerFields.name;
        const matches = customerList.filter(c =>
          (c[nameKey] || "").toLowerCase().includes(val)
        );
        if (matches.length === 0) {
          list.style.display = 'none';
          return;
        }
        matches.slice(0, 20).forEach((c, idx) => {
          const item = document.createElement('div');
          item.className = 'autocomplete-item';
          item.textContent = c[nameKey];
          item.tabIndex = -1;
          item.onmousedown = function(e) {
            e.preventDefault();
            input.value = c[nameKey];
            fillCustomerDetails(c);
            list.innerHTML = '';
            list.style.display = 'none';
          };
          list.appendChild(item);
        });
        list.style.display = '';
      };
      input.onkeydown = function(e) {
        let items = list.querySelectorAll('.autocomplete-item');
        if (!items.length) return;
        if (e.key === "ArrowDown") {
          e.preventDefault();
          activeIndex = (activeIndex + 1) % items.length;
          updateActive(items, activeIndex);
        } else if (e.key === "ArrowUp") {
          e.preventDefault();
          activeIndex = (activeIndex - 1 + items.length) % items.length;
          updateActive(items, activeIndex);
        } else if (e.key === "Enter") {
          if (activeIndex > -1) {
            e.preventDefault();
            items[activeIndex].dispatchEvent(new Event('mousedown'));
          }
        }
      };
      function updateActive(items, idx) {
        items.forEach((item, i) => {
          if (i === idx) item.classList.add('autocomplete-active');
          else item.classList.remove('autocomplete-active');
        });
      }
      input.onblur = function() {
        setTimeout(() => { list.style.display = 'none'; }, 200);
      };
      input.onchange = function() {
        const val = this.value.trim().toLowerCase();
        const nameKey = customerFields.name;
        const customer = customerList.find(c => (c[nameKey] || "").toLowerCase() === val);
        if (customer) fillCustomerDetails(customer);
      };
    }

    fetchCustomerList();
  </script>
</body>
</html>
